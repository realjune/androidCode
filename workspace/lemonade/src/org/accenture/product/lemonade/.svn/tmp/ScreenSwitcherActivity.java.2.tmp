package org.accenture.product.lemonade;

import java.util.ArrayList;

import org.accenture.product.lemonade.view.HomeScreenLayout;

import android.app.Activity;
import android.content.res.Resources;
import android.graphics.Bitmap;
import android.graphics.PixelFormat;
import android.graphics.drawable.BitmapDrawable;
import android.os.Bundle;
import android.os.Handler;
import android.os.Message;
import android.util.DisplayMetrics;
import android.util.Log;
import android.view.Gravity;
import android.view.MotionEvent;
import android.view.View;
import android.view.Window;
import android.view.WindowManager;
import android.widget.Button;
import android.widget.ImageView;
import android.widget.LinearLayout;
import android.widget.LinearLayout.LayoutParams;

/**
 * 
 * @author shaohu.zhu
 */
public class ScreenSwitcherActivity extends Activity
{
	public static ArrayList<Bitmap> thumbnailList;
	
	
	int imageViewHeight;

	private static Launcher mLauncher;
	Button delete;
	LinearLayout line1;
	LinearLayout line2;
	LinearLayout line3;
	
	HomeScreenHandler handler;
	
	@Override
	protected void onCreate(Bundle savedInstanceState)
	{

		super.onCreate(savedInstanceState);
		requestWindowFeature(Window.FEATURE_NO_TITLE);

		setContentView(R.layout.screenswitcher);

		line1=(LinearLayout)findViewById(R.id.line1);
		line2=(LinearLayout)findViewById(R.id.line2);
		line3=(LinearLayout)findViewById(R.id.line3);
		delete=(Button)findViewById(R.id.delete);
		
		addButtonListener();
		deleteButtonListener();

		fillScreen();
		
		handler=new HomeScreenHandler();
	}
	
	public void deleteScreen(){
		handler.sendEmptyMessage(0);
	}
	
	private void addScreen(){
		mLauncher.addOneScreen();
		line1.removeAllViews();
		line2.removeAllViews();
		line3.removeAllViews();
		fillScreen();
	}

	private void addButtonListener()
	{
		Button add = (Button) findViewById(R.id.add);
		add.setOnClickListener(new View.OnClickListener()
		{

			@Override
			public void onClick(View v)
			{				
				addScreen();
			}
		});
	}

	private void deleteButtonListener()
	{
		delete.setOnClickListener(new View.OnClickListener()
		{

			@Override
			public void onClick(View v)
			{
				deleteScreen();
			}
		});
	}

	private void fillScreen()
	{
		Resources resources = getResources();
		
		final HomeScreenLayout mainLayout=(HomeScreenLayout)findViewById(R.id.homescreenlayout);
				
		if (thumbnailList != null && thumbnailList.size() > 4)
		{
			for (int i = 0; i < thumbnailList.size(); i++)
			{
				ImageView imageView = new ImageView(this);
				imageView.setAdjustViewBounds(true);
				LayoutParams layoutParams = new LinearLayout.LayoutParams(96, 120);
				layoutParams.setMargins(5, 5, 5, 5);
				imageView.setLayoutParams(layoutParams);
				imageView.setImageBitmap(thumbnailList.get(i));
				imageView.setBackgroundDrawable(resources.getDrawable(R.drawable.preview_background));
				
				imageView.setOnLongClickListener(new View.OnLongClickListener()
				{
					
					@Override
					public boolean onLongClick(View v)
					{	
						mainLayout.setView(v,delete);
						mainLayout.startDragging();
						return false;
					}
				});
				
				if(i==0){
					imageViewHeight=imageView.getHeight();
				}
				
				switch (thumbnailList.size())
				{
					case 5:
						if (i == 0)
							line1.addView(imageView);
						else if (i == 1 || i == 2 || i == 3)
							line2.addView(imageView);
						else if (i == 4)
							line3.addView(imageView);
						break;
					case 6:
						if (i == 0 || i == 1)
							line1.addView(imageView);
						else if (i == 2 || i == 3 || i == 4)
							line2.addView(imageView);
						else if (i == 5)
							line3.addView(imageView);
						break;
					case 7:
						if (i == 0 || i == 1)
							line1.addView(imageView);
						else if (i == 2 || i == 3 || i == 4)
							line2.addView(imageView);
						else if (i == 5 || i == 6)
							line3.addView(imageView);
						break;
					case 8:
						if (i == 0 || i == 1 || i == 2)
							line1.addView(imageView);
						else if (i == 3 || i == 4 || i == 5)
							line2.addView(imageView);
						else if (i == 6 || i == 7)
							line3.addView(imageView);
						break;
					case 9:
						if (i == 0 || i == 1 || i == 2)
							line1.addView(imageView);
						else if (i == 3 || i == 4 || i == 5)
							line2.addView(imageView);
						else if (i == 6 || i == 7 || i == 8)
							line3.addView(imageView);
						break;
				}
			}
		}
	}
	
	public static void initPic(ArrayList<Bitmap> thumbList)
	{
		thumbnailList = thumbList;
	}

	public static void setLauncher(Launcher launcher)
	{
		mLauncher = launcher;
	}

	private void gotoScreen(int index)
	{
		mLauncher.setCurrentScreen(index);
	}
	
	private class HomeScreenHandler extends Handler {
		
		@Override
		public void handleMessage(Message msg) {
			mLauncher.removeOneScreen();
			line1.removeAllViews();
			line2.removeAllViews(); 
			line3.removeAllViews();
			fillScreen();
		}
	}
}
